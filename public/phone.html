<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="build/css/intlTelInput.css">
    <link rel="stylesheet" href="build/css/demo.css">
    <link rel="icon" href="../../images/iyte-comp-logo.png">

    <title>Phone Verification</title>
</head>

<body>
    <nav class="navbar navbar-dark fixed-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#"><img src="../../images/iyte-comp-logo.png" alt=""
                width="32" height="32"> Izmir Institute Of Technology</a>
        <ul class="navbar-nav px-3">
        </ul>
    </nav>

    <div class="container" style="width: fit-content; padding-top: 15%;">
        <div class="form-group row">
            <p class="card-text">We will send you a text message with a verification code that <br> you'll need to enter
                on the next screen.</p>
        </div>
        <div class="form-group row">
        </div>
        <div class="form-group row">
            <label for="inputEmail3" class="col-auto col-form-label">Phone</label>
            <div class="col-auto">
                <input id="phone" name="phone" type="tel">
            </div>
            <div class="col-auto">
                <button type="button" class="btn btn-primary" id="sendCode" onclick="">Send</button>
            </div>
        </div>
    </div>


    <script src="/__/firebase/7.14.2/firebase-app.js"></script>
    <script src="/__/firebase/7.14.2/firebase-auth.js"></script>
    <script src="/__/firebase/7.14.2/firebase-database.js"></script>
    <script src="/__/firebase/7.14.2/firebase-storage.js"></script>
    <script src="/__/firebase/init.js"></script>
    <script>
        window.recaptchaVerifier = new firebase.auth.RecaptchaVerifier('sendCode', {
            'size': 'invisible',
            'callback': function (recaptchaToken) {
                var phone = document.getElementById('dialCode').innerText + document.getElementById('phone')
                    .value;
                var url = '/sendCode'
                var body = {
                    phoneNumber: phone,
                    recaptchaToken,
                }
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function () {
                    if (xhr.readyState == 4 && xhr.status == 200) {
                        console.log(xhr.response)
                        document.cookie = "phone=" + phone;
                        opener.phone(phone)
                    }
                };
                xhr.open("POST", url, true);
                xhr.setRequestHeader('Content-Type', 'application/json');
                xhr.send(JSON.stringify(body));
            }
        });
        window.recaptchaVerifier.render().then(function (widgetId) {
            window.recaptchaWidgetId = widgetId;
        });
    </script>
    <script src="build/js/intlTelInput.js"></script>
    <script>
        var input = document.querySelector("#phone");
        window.intlTelInput(input, {
            dropdownContainer: document.body,
            preferredCountries: ['tr', 'us'],
            separateDialCode: true,
            utilsScript: "build/js/utils.js",
        });
    </script>
</body>

</html>